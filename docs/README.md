# Sphinx documentation of toulbar2

## step3

Livraison d’une version :

- (succédant à step1, step2) prenant en compte sous Sphinx (docs) la documentation qui existait précédemment sous Doxygen (doc).
- réorganisant le plan de la documentation (regroupements…), étant donnée la réécriture/insertion de nouvelles pages .rst.
- prenant en compte une grande partie de ce qui a été vu/dit en réunion jeudi 10 mars 2022, mais pas fini.

- supprimant de toulbar2/README.md du texte faisant doublon avec du texte du site (presentation.rst, publications.rst).
- ref_cpp.rst a été complété.

Voir document NotesReunions.odt pour plus de details.


## General

The **'toulbar2/docs'** folder is dedicated to the **Sphinx** documentation of toulbar2.

Documentation replacing the previous .html pages of **'toulbar2/web'** folder and also most of the **'doc'** folder that does not exist anymore.

Documentation **using files of some other folders**, such as 'toulbar2/web', 'toulbar2/misc/doc'.

Documentation **hosted on GitHub Pages**, built with **GitHub free CI/CD tool** ; with a **redirection** of current toulbar2 site to those GitHub Pages.

## Documentation content

- The .rst pages have been created from .html pages of 'toulbar2/web'.
- The documentation also contains generated (by Doxygen+Breathe) 
  documentation of toulbar2 python code (toulbar2/pytoulbar2) and
  of toulbar2 C++ code (toulbar2/src).
- Most of the documentation previously into 'doc' folder has been rewritten
  as .rst pages.

## Creation

- Sphinx :

  Install sphinx :

        sudo apt-get install -y python3-sphinx
        sudo apt-get install -y python3-sphinx-rtd-theme

  Setup sphinx site  :

        cd docs
        sphinx-quickstart

  Modify conf.py :

    - change theme from 'alabaster' to 'sphinx_rtd_theme'
    - define python code path

- C++ documentation :
  
  Generated by **Doxygen + Breathe** : the **build/xml** folder content,
  built by Doxygen, is then used by Sphinx (via Breathe).  

  Add into toulbar2/Doxyfile.in :

        GENERATE_XML = YES

  Add 'Breathe' into requirement.txt file and conf.py
  (extensions, breathe_projects).

## [Local build](README/local_build.md)

## Deploy by CI/CD

- Documentation installed by CI/CD on GitHub Pages
  [toulbar2.github.io/toulbar2](toulbar2.github.io/toulbar2).

  Redirections from the toulbar2 site main URL
  **miat.inrae.fr/toulbar2** to the documentation on GitHub Pages
  **toulbar2.github.io/toulbar2**.

- Install :

  - File .github/workflows/docs-deploy.yml
  - On the repository :
    "Settings" / "Pages" choose 'gh-pages branch' under "Source"

- CI/CD result/production :

  - **Doc online at : https://toulbar2.github.io/toulbar2**

  - **.pdf** are accessible from .html pages (see "Resources" page).

    Also direct access to .pdf :

    - https://toulbar2.github.io/toulbar2/pdf/toulbar2.pdf 
    - https://toulbar2.github.io/toulbar2/pdf/cpp_library.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/python_library.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/userdoc.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/refman.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/tutorials.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/WCSP_format.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/CFN_format.pdf  

## Required

- The Sphinx documentation (docs) requires as input data (**from misc/doc**) :

  - **toulbar2-class.pdf** 
  - **out_*.txt** (to be previously generated by Toulbar2_out.sh).
  - **HELP** file (result of command 'toulbar2 --help') : to be updated when
    toulbar2 code modifications.

## Warnings

- The **"@mainpage" text** (of src/toulbar2lib.hpp) has been manually copied
  into the .rst ("Introduction" of page « Reference Manual")
  => **NOT** generated from C++ source code.

- "Breathe" puts the text of some Doxygen keywords
  (such as "Warning" and "Note") at the end of the generated text.
  So if C++ comments (about generated documentation) contains some 
  notes or warnings, **do not use Doxygen keywords** (use *normal* text)
  in order to keep text order (especially into *'defgroup'* parts).

