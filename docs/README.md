# Sphinx documentation of toulbar2

  **Table of contents :**

  * [Overview](#overview)
  * [Creation](#creation)
  * [Deploy by CI/CD](#deploy-by-cicd)
  * [Required](#required)
  * [Warnings](#warnings)
  * [Local build](#local-build)

## step3

Livraison d’une version :

- (succédant à step1, step2) prenant en compte sous Sphinx (docs) la documentation qui existait précédemment sous Doxygen (doc).
- réorganisant le plan de la documentation (regroupements…), étant donnée la réécriture/insertion de nouvelles pages .rst.
- prenant en compte une grande partie de ce qui a été vu/dit en réunion jeudi 10 mars 2022, mais pas fini.

- supprimant de toulbar2/README.md du texte faisant doublon avec du texte du site (presentation.rst, publications.rst).
- ref_cpp.rst a été complété.

Voir document NotesReunions.odt pour plus de details.


## Overview

- The **'toulbar2/docs'** folder is dedicated to the **Sphinx** documentation
  of toulbar2.

- Documentation replacing the previous .html pages of **'toulbar2/web'**
  folder and also most of the **'doc'** folder *(a)*.

- Documentation **using files of some other folders**, such as 'toulbar2/web',
  'toulbar2/misc/doc' *(a)*.

- Documentation also containing generated (by Doxygen+Breathe) 
  documentation of toulbar2 python code and of toulbar2 C++ code.

- Generated : .html pages and .pdf files.

- Documentation **hosted on GitHub Pages**, built with
  **GitHub free CI/CD tool** ; with a **redirection** of current toulbar2 site
  to those GitHub Pages.

*(a) The 'doc' folder does not exist anymore : most of the documentation previously into 'doc' folder has been rewritten into 'docs' as .rst pages, and remaining 'doc' content now into 'misc/doc'*.

## Creation

- Sphinx :

  Install sphinx :

        sudo apt-get install -y python3-sphinx
        sudo apt-get install -y python3-sphinx-rtd-theme

  Setup sphinx site  :

        cd docs
        sphinx-quickstart

  Modify conf.py :

    - change theme from 'alabaster' to 'sphinx_rtd_theme'
    - define python code path

- C++ documentation :
  
  Generated by **Doxygen + Breathe** : the **build/xml** folder content,
  built by Doxygen, is then used by Sphinx (via Breathe).  

  Add into toulbar2/Doxyfile.in :

        GENERATE_XML = YES

  Add 'Breathe' into requirements.txt file and conf.py
  (extensions, breathe_projects).

## Deploy by CI/CD

- Documentation installed by CI/CD on GitHub Pages
  [toulbar2.github.io/toulbar2](toulbar2.github.io/toulbar2).

  With redirections from the toulbar2 site main URL
  **miat.inrae.fr/toulbar2** to the documentation on GitHub Pages
  **toulbar2.github.io/toulbar2**.

- Install :

  - File .github/workflows/docs-deploy.yml
  - On the repository :
    "Settings" / "Pages" choose 'gh-pages branch' under "Source"

- CI/CD result/production :

  - **Documentation online at : https://toulbar2.github.io/toulbar2**

  - **.pdf** are accessible from .html pages (see "Resources" page).

    Also direct access to .pdf :

    - https://toulbar2.github.io/toulbar2/pdf/toulbar2.pdf 
    - https://toulbar2.github.io/toulbar2/pdf/cpp_library.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/python_library.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/userdoc.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/refman.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/tutorials.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/WCSP_format.pdf  
    - https://toulbar2.github.io/toulbar2/pdf/CFN_format.pdf  

## Required

- The Sphinx documentation (docs) requires as input data (**from misc/doc**) :

  - **toulbar2-class.pdf** 
  - **out_*.txt** (to be previously generated by Toulbar2_out.sh).
  - **HELP** file (result of command 'toulbar2 --help') : to be updated when
    toulbar2 code modifications.

## Warnings

- The **"@mainpage" text** (of src/toulbar2lib.hpp) has been manually copied
  into the .rst ("Introduction" of page « Reference Manual")
  => **NOT** generated from C++ source code.

- "Breathe" puts the text of some Doxygen keywords
  (such as "Warning" and "Note") at the end of the generated text.
  So if C++ comments (about generated documentation) contains some 
  notes or warnings, **do not use Doxygen keywords** (use *normal* text)
  in order to keep text order (especially into *'defgroup'* parts).

## Local build

### Install 'pyvenv' python virtual environment

- Some required basic tools to be installed if not already installed :

  python 3, pip3, python3 virtual environment tool :

      apt-get install python3
      apt-get install python3-pip
      apt-get install python3-venv

- Install _pyvenv virtual environment

  Commands to create, activate, then install from requirements.txt :

      python3 -m venv _pyvenv
      source _pyvenv/bin/activate
      pip3 install -r requirements.txt

- Use _pyvenv virtual environment

  Activate :

      source _pyvenv/bin/activate

### Commands to generate documentation

#### Doxygen

_The build/xml folder content, built by Doxygen, will be used by Sphinx
(via breathe).

- see HowTo.build.Toulbar2 ::

      # Howto generate toulbar2 source documentation
      # first install the following package required

      sudo apt-get install texlive-latex-recommended texlive-fonts-recommended
      sudo apt-get install doxygen

      # for generating documentation use the following command:

      mkdir build ; cd build
      cmake -DBUILD_API_DOC=ON .. ; make doc

#### Sphinx

- init and clear ::

    source _pyvenv/bin/activate
    cd .. ; ./clean ; cd docs ;

- pdf then html ::

    make docs

- or : 

  - pdf with latex ::

      make files

  - html ::

      make html ;

- epub ::

    make epub ;

### Productions
    
- _build/html folder where index.html
- .pdf under _files (and _build/latex)
- .epub under _build/epub

